# CRM для барбершопа

Простая CRM для барбершопа на python flask и vue.js

## Разработка

Бэк на Python Flask. Фронт на Vue.js.

Установка зависимостей:

```
pip3 install -r requirements.txt
```

Запуск веба:

```
python -m app
```

Билд фронта:

```
cd front
npm install
npm run build
```

Файлы фронта после билда складываются в папку dist, их оттуда отдаёт веб-сервер фласка.

## API для фронта

### Описание

API по принципу JSON RPC. Все вызовы через POST запрос. На входе JSON, на выходе JSON. Авторизация через куки.

Некоторые методы могут отдавать ошибки. Тогда в теле ответа отдавать 

```
{
    “error”: “Описание ошибки”
}
```

Некоторые методы могут отдавать предупреждения. Тогда в теле ответа отдавать дополнительно

```
{
…
    “Info”: “Текст предупреждения”
}
```

### Типы данных

#### Roles

```
{
    1: “officeAdmin”,
    2: “manager”,
    3: “master”
}
```

#### SessionState

```
{
    1: “open”,
    2: “closed”
}
```

#### OperationType

```
{
    1: “service”,
    2: “itemSell”,
    3: “spend”,
    4: “employeePayment”
}
```

### Методы

#### GetUserData

Возвращает данные текущего юзера.

##### URL

```
api/GetUserData/
```

##### Вход

```
{}
```

##### Выход

```
{
    “name”: “Имя пользователя”,
    “pictureUrl”: “ссылка на фотку юзера”,
    “roles”: [“массив ролей пользователя из Roles”]
}
```

#### GetCurrentSession

Возвращает текущую (открытую) смену. Если нет текущей смены, возвращает пустой объект.

##### URL

```
api/GetCurrentSession/
```

##### Вход

```
{}
```

##### Выход

Если нет открытой смены

```
{}
```

Иначе

```
{
    “dateOpened”: “дата и время открытия смены в формате dd.mm.yyyy HH:MM“,
    “dateClosed”: “дата и время закрытия смены в формате dd.mm.yyyy HH:MM“,
    “employees”: [ //Список мастеров и админов с часами работы
        {
            “Id”: id сотрудника,
            “name”: “имя сотрудника”,
            “role”: роль пользователя из Roles. Может быть officeAdmin или master
            “pictureUrl”: “ссылка на фотку сотрудника”,
            “workHours”: количество рабочих часов
        }
    ],
    “officeId”: id отделения,
    “state”: состояние смены из SessionState (по логике метода, здесь всегда должно быть open),
    “Operations”: [ // массив операций, проведённых за смену
        {
        “operationType”: OperationType,
        … // все параметры операции в зависимости от типа
        }
    ] 
}
```

#### GetServicesPrices

Возвращает список услуг с ценами.

##### URL

```
api/GetServicesPrices/
```

##### Вход

```
{}
```

##### Выход

```
[
    {
        “Id”: id услуги,
        “name”: название услуги,
        “prices” {
            id категории мастера: цена,
            ...
        }
    }
]
```
